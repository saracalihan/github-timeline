const _style=document.createElement("link");_style.setAttribute("rel","stylesheet"),_style.setAttribute("href","https://cdn.jsdelivr.net/gh/saracalihan/github-timeline/css/style.css"),document.head.appendChild(_style);const timelines=document.getElementsByClassName("github-timeline"),getUserInfo=function(e){return new Promise((function(t,n){try{fetch("https://api.github.com/users/"+e).then((e=>e.json())).then((e=>{e.url?t({type:"user",isSuccess:!0,data:e}):t({type:"user",isSuccess:!1,data:e})}))}catch(e){n(e)}}))},getUserEvents=function(e){return new Promise((function(t,n){try{fetch("https://api.github.com/users/"+e+"/events").then((e=>e.json())).then((e=>{Array.isArray(e)&&e.length>0?t({type:"events",isSuccess:!0,data:e}):t({type:"events",isSuccess:!1,data:e})}))}catch(e){n(e)}}))},createTimeline=function(e){let t=e.dataset.theme?e.dataset.theme:"light";e.classList.add(t),e.innerHTML=`\n        <div class="header">\n          Github Events <small class="header-small">by \n          <a\n            style="color: rgb(61, 61, 255);font-size: 14px;"\n            href="https://github.com/${e.dataset.username}"\n            target="_blank"\n          >\n            @${e.dataset.username}\n          </a>\n        </small>\n        </div>\n        <ul class="events">\n          \x3c!-- Events inject here --\x3e\n        </ul>\n        `},injectEventComponents=function(e,t,n){let a=e.childNodes[3];if(console.log(t,n),!t||!n){let e=t?"Oops! We couldn't find any activity of the user":"User not found!";return a.innerHTML=`<p class="not-found">${e}</p>`}for(let e of n){let n={year:"numeric",month:"long",day:"numeric"},s=new Date(e.created_at).toLocaleDateString("en-US",n),i=e.repo.name.split("/")[0].toLowerCase(),l=e.org?e.org.avatar_url:e.actor.avatar_url,r=document.createElement("li");r.className="event",r.innerHTML=`\n            <div style="display: flex;flex-direction: column;align-content: center;justify-content: center;">\n              <a \n                href="https://github.com/${i}"\n                title="${i}"\n              >\n                <img \n                  src="${l}"\n                  alt="User Avatar"\n                  class="avatar"\n                >\n              </a>\n            </div>\n            <div class="event-detail">\n                <a \n                  href="https://github.com/${i}"\n                  class="event-name"\n                >\n                  ${i}\n                </a>\n              <p style="margin:0">\n                ${t.name} ${e.payload.action?e.payload.action:""} ${e.type.replace("Event","").split(/(?=[A-Z])/).join(" ").toLowerCase()}  \n              </p>\n              <a\n                href="https://github.com/${e.repo.name}"\n                style="margin:0;text-decoration: none;"\n              >\n                to: ${e.repo.name}\n              </a>\n            </div>\n            <div style="display: flex;flex-direction: column;align-items: flex-end;justify-content: space-between">\n              <p class="date">\n                ${s}\n              <p>\n            </div>\n          `,r.addEventListener("click",(function(){window.open(`https://github.com/${e.repo.name}`,"_blank")})),a.appendChild(r)}let s=document.createElement("div");s.className="footer",s.innerHTML='Coded by <a href="https://github.com/saracalihan/" target="_blank">@saracalihan</a>',a.appendChild(s)},rander=function(e,t,n){createTimeline(e),injectEventComponents(e,t,n)};for(let e of timelines){let t={},n=[];Promise.all([getUserInfo(e.dataset.username),getUserEvents(e.dataset.username)]).then((function(a){t=a.find((e=>"user"===e.type&&e.isSuccess))||null,n=a.find((e=>"events"===e.type&&e.isSuccess))||null,t=t?t.data:null,n=n?n.data:null,rander(e,t,n)}))}
